sudo: required
services:
  - docker
language: bash

script:
  # prepare qemu
  - docker run --rm --privileged multiarch/qemu-user-static:register --reset
  # build homie-dashboard images
  - travis_wait 60 make TARGET=armhf
  - travis_wait 60 make TARGET=amd64
  # push images. $VERSION is populated by the POST request
  - docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD"  
  - docker tag homiedashboard/armhf "homiedashboard/armhf:$VERSION"
  - docker push "homiedashboard/armhf:$VERSION"
  - docker tag homiedashboard/amd64 "homiedashboard/amd64:$VERSION"
  - docker push "homiedashboard/amd64:$VERSION"
  - docker push homiedashboard/armhf
  - docker push homiedashboard/amd64
    
after_success:
  - echo "Done!"
